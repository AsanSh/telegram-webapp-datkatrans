<!DOCTYPE html>
<html>
<head>
    <title>DatkaTrans Portal</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1 class="welcome-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">...</span></h1>
        </div>

        <!-- Request Counter -->
        <div class="counter-section">
            <div class="counter-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫</div>
            <div class="counter-amount" id="requests-count">2</div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-button add-button" onclick="showRequestForm()">
                <span class="action-icon">‚ûï</span>
                <span class="action-text">–î–æ–±–∞–≤–∏—Ç—å</span>
            </button>
            <button class="action-button edit-button">
                <span class="action-icon">‚úèÔ∏è</span>
                <span class="action-text">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
            </button>
            <button class="action-button close-button">
                <span class="action-icon">‚úñÔ∏è</span>
                <span class="action-text">–ó–∞–∫—Ä—ã—Ç—å</span>
            </button>
            <button class="action-button analytics-button">
                <span class="action-icon">üìä</span>
                <span class="action-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </button>
        </div>

        <!-- Request Form Modal -->
        <div id="requestFormModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</h2>
                    <span class="close-modal" onclick="closeRequestForm()">&times;</span>
                </div>
                <form id="requestForm" onsubmit="handleRequestSubmit(event)">
                    <div class="form-group">
                        <label for="closeDate">–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</label>
                        <input type="date" id="closeDate" name="closeDate" required>
                    </div>
                    <div class="form-group">
                        <label for="shipmentDate">–î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏</label>
                        <input type="date" id="shipmentDate" name="shipmentDate" required>
                    </div>
                    <div class="form-group">
                        <label for="logistician">–õ–æ–≥–∏—Å—Ç</label>
                        <input type="text" id="logistician" name="logistician" required>
                    </div>
                    <div class="form-group">
                        <label for="unloadingDate">–î–∞—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏</label>
                        <input type="date" id="unloadingDate" name="unloadingDate" required>
                    </div>
                    <div class="form-group">
                        <label for="driverName">–§–ò–û –≤–æ–¥–∏—Ç–µ–ª—è</label>
                        <input type="text" id="driverName" name="driverName" required>
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="cargoType">–¢–∏–ø –≥—Ä—É–∑–∞</label>
                        <input type="text" id="cargoType" name="cargoType" required>
                    </div>
                    <div class="form-group">
                        <label for="vehicleNumber">–ì–æ—Å–Ω–æ–º–µ—Ä –∞–≤—Ç–æ</label>
                        <input type="text" id="vehicleNumber" name="vehicleNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="direction">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                        <input type="text" id="direction" name="direction" required>
                    </div>
                    <div class="form-group">
                        <label for="ourFreight">–§—Ä–∞—Ö—Ç –Ω–∞–º</label>
                        <input type="number" id="ourFreight" name="ourFreight" required>
                    </div>
                    <div class="form-group">
                        <label for="driverFreight">–§—Ä–∞—Ö—Ç –≤–æ–¥–∏—Ç–µ–ª—é</label>
                        <input type="number" id="driverFreight" name="driverFreight" required>
                    </div>
                    <div class="form-group">
                        <label for="tax">–ù–∞–ª–æ–≥</label>
                        <input type="number" id="tax" name="tax" required>
                    </div>
                    <div class="form-group">
                        <label for="office">–û—Ñ–∏—Å</label>
                        <input type="text" id="office" name="office" required>
                    </div>
                    <button type="submit" class="submit-button">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                </form>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-sections">
            <!-- Active Requests Section -->
            <div class="section-content active" id="requests-section">
                <h3 class="section-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
                <div class="requests-list" id="requestsList">
                    <!-- Request items will be added here dynamically -->
                </div>
            </div>

            <!-- Shipment Section -->
            <div class="section-content" id="shipment-section" style="display: none;">
                <h3 class="section-title">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≥—Ä—É–∑–∫—É</h3>
                <div class="requests-list" id="shipmentList">
                    <!-- Shipment requests will be added here -->
                </div>
            </div>

            <!-- Closed Section -->
            <div class="section-content" id="closed-section" style="display: none;">
                <h3 class="section-title">–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞—è–≤–∫–∏</h3>
                <div class="requests-list" id="closedList">
                    <!-- Closed requests will be added here -->
                </div>
            </div>

            <!-- History Section -->
            <div class="section-content" id="history-section" style="display: none;">
                <h3 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫</h3>
                <div class="requests-list" id="historyList">
                    <!-- History items will be added here -->
                </div>
            </div>
        </div>

        <!-- Shipment Date Modal -->
        <div id="shipmentDateModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É –≤—ã–≥—Ä—É–∑–∫–∏</h2>
                    <span class="close-modal" onclick="closeShipmentDateModal()">&times;</span>
                </div>
                <form id="shipmentDateForm" onsubmit="handleShipmentDateSubmit(event)">
                    <div class="form-group">
                        <label for="shipmentDate">–î–∞—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏</label>
                        <input type="date" id="shipmentDate" name="shipmentDate" required>
                    </div>
                    <input type="hidden" id="requestId" name="requestId">
                    <button type="submit" class="submit-button">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-section="requests-section">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">–ó–∞—è–≤–∫–∏</span>
            </button>
            <button class="nav-item" data-section="shipment-section">
                <span class="nav-icon">üì§</span>
                <span class="nav-text">–í—ã–≥—Ä—É–∑–∫–∞</span>
            </button>
            <button class="nav-item" data-section="closed-section">
                <span class="nav-icon">üîí</span>
                <span class="nav-text">–ó–∞–∫—Ä—ã—Ç–∏–µ</span>
            </button>
            <button class="nav-item" data-section="history-section">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-text">–ò—Å—Ç–æ—Ä–∏—è</span>
            </button>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', path='/js/main.js') }}"></script>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
        console.log('Checking functions:', {
            showRequestForm: typeof showRequestForm,
            closeRequestForm: typeof closeRequestForm,
            handleRequestSubmit: typeof handleRequestSubmit
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        console.log('Modal element:', document.getElementById('requestFormModal'));

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –∑–¥–µ—Å—å
        document.querySelector('.add-button').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Add button clicked');
            const modal = document.getElementById('requestFormModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('Modal should be visible now');
            } else {
                console.log('Modal element not found');
            }
        });
    </script>
</body>
</html> 